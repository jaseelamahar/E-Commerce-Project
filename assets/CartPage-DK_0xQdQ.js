import{r as c,u as U,e as d,y as g,l as m,b as n,o as j,j as s,v as k,d as l,p as y,x as h,z as F,A as I}from"./index-DZrLkeQP.js";const P=()=>{const[a,N]=c.useState([]),[v,w]=c.useState(!0),[i,C]=c.useState([]),p=U(),b=c.useRef(!1);c.useEffect(()=>{const e=d.currentUser;if(!e){b.current||(g.info("Please login to see your cart"),b.current=!0),p("/login");return}const t=m(n,"users",e.uid,"cart"),o=j(t,u=>{const x=u.docs.map(r=>({id:r.id,...r.data()}));N(x),w(!1)}),S=m(n,"users",e.uid,"orders"),D=j(S,u=>{const x=u.docs.map(r=>({id:r.id,...r.data()})).sort((r,L)=>L.createdAt?.toMillis()-r.createdAt?.toMillis());C(x)});return()=>{o(),D()}},[p]);const R=async e=>{const t=l(n,"users",d.currentUser.uid,"cart",e.id);await y(t,{quantity:e.quantity+1})},q=async e=>{const t=l(n,"users",d.currentUser.uid,"cart",e.id);e.quantity>1?await y(t,{quantity:e.quantity-1}):await h(t)},O=async e=>{const t=l(n,"users",d.currentUser.uid,"cart",e.id);await h(t)},f=a.reduce((e,t)=>e+t.price*t.quantity,0),A=async()=>{const e=d.currentUser;if(!e||a.length===0)return;const t=m(n,"users",e.uid,"orders");await F(t,{items:a,total:f,status:"ordered",createdAt:I()});for(const o of a)await h(l(n,"users",e.uid,"cart",o.id));g.success("Order placed successfully!")};return v?s.jsx("div",{className:"p-6 text-center",children:"Loading cart..."}):!a.length&&!i.length?s.jsx("div",{className:"p-6 text-center",children:"Your cart is empty."}):s.jsxs("div",{className:"container mx-auto p-6",children:[s.jsx(k,{position:"top-right",autoClose:3e3}),s.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Your Cart"}),a.length>0&&s.jsx("div",{className:"flex flex-col gap-4 mb-6",children:a.map(e=>s.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between border p-4 rounded-lg shadow-sm gap-4",children:[s.jsx("img",{src:e.image,alt:e.name,className:"w-32 h-32 object-cover rounded-lg"}),s.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[s.jsx("h3",{className:"text-xl font-semibold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Rs",e.price.toFixed(2)]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>q(e),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"-"}),s.jsx("span",{className:"px-3 py-1 border rounded",children:e.quantity}),s.jsx("button",{onClick:()=>R(e),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"+"}),s.jsx("button",{onClick:()=>O(e),className:"ml-4 text-red-500 hover:text-red-700",children:"Remove"})]})]})]},e.id))}),a.length>0&&s.jsxs("div",{className:"mt-6 flex justify-end items-center gap-6",children:[s.jsxs("h3",{className:"text-2xl font-bold",children:["Total: Rs",f.toFixed(2)]}),s.jsx("button",{onClick:A,className:"bg-amber-300 text-white px-6 py-2 rounded-full hover:bg-amber-400 transition",children:"Order Now"})]}),i.length>0&&s.jsxs("div",{className:"mt-12",children:[s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Order History"}),i.map(e=>s.jsxs("div",{className:"border p-4 rounded-lg shadow-sm mb-4",children:[s.jsxs("h3",{className:"font-semibold",children:["Order ID: ",e.id]}),s.jsxs("p",{children:["Total: $",e.total.toFixed(2)]}),s.jsxs("p",{className:"text-gray-500 text-sm",children:["Ordered on: ",e.createdAt?.toDate().toLocaleString()]}),s.jsx("div",{className:"mt-2",children:e.items.map(t=>s.jsxs("div",{className:"flex justify-between border-b py-1",children:[s.jsxs("span",{children:[t.name," x ",t.quantity]}),s.jsxs("span",{children:["$",(t.price*t.quantity).toFixed(2)]})]},t.id))}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[e.status==="ordered"&&s.jsx("button",{className:"px-4 py-1 bg-blue-500 text-white rounded",children:"Ordered"}),e.status==="confirmed"&&s.jsx("button",{className:"px-4 py-1 bg-green-500 text-white rounded",children:"Confirmed"}),e.status==="cancelled"&&s.jsx("button",{className:"px-4 py-1 bg-red-500 text-white rounded",children:"Cancelled"}),e.status==="available"&&s.jsx("button",{className:"px-4 py-1 bg-green-500 text-white rounded",children:"Available"})]})]},e.id))]})]})};export{P as default};
