import{r as o,u as M,e as t,y as d,l as h,b as a,o as N,q as _,z as A,j as s,A as F,d as c,B as u,C as g,D as B,E as H}from"./index-BJY4bUza.js";const K=()=>{const[n,p]=o.useState([]),[v,w]=o.useState(!0),[C,x]=o.useState(!1),[V,k]=o.useState(""),[i,O]=o.useState(null),[b,q]=o.useState(!1),l=M();o.useEffect(()=>{const e=t.currentUser;if(!e){d.info("Please login to see your cart",{toastId:"login-toast"}),l("/login");return}const r=h(a,"users",e.uid,"cart"),m=N(r,f=>{const L=f.docs.map(j=>({id:j.id,...j.data()}));p(L),w(!1)}),z=h(a,"users",e.uid,"orders"),T=_(z,A("createdAt","desc")),D=N(T,f=>{q(f.docs.length>0)});return()=>{m(),D()}},[l]);const S=async e=>{const r=c(a,"users",t.currentUser.uid,"cart",e.id);await u(r,{quantity:e.quantity+1})},U=async e=>{const r=c(a,"users",t.currentUser.uid,"cart",e.id);e.quantity>1?await u(r,{quantity:e.quantity-1}):await g(r)},R=async e=>{const r=c(a,"users",t.currentUser.uid,"cart",e.id);await g(r)},y=n.reduce((e,r)=>e+r.price*r.quantity,0),I=async()=>{if(!t.currentUser||n.length===0){d.error("Cart is empty or you are not logged in");return}try{const e="TRK"+Math.floor(Math.random()*1e6);k(e);const r=h(a,"users",t.currentUser.uid,"orders"),m=await B(r,{items:n,total:y,email:t.currentUser.email,status:"pending",tracking_number:e,tracking_status:"Pending",createdAt:H()});O(m.id),x(!0)}catch(e){console.error("ðŸ”¥ Error placing order:",e),d.error("Failed to place order. Check console for details.")}},P=async()=>{if(!i)return;const e=c(a,"users",t.currentUser.uid,"orders",i);await u(e,{status:"confirmed",tracking_status:"In Transit"}),n.length>0&&(await Promise.all(n.map(r=>g(c(a,"users",t.currentUser.uid,"cart",r.id)))),p([])),x(!1),d.success("Order Confirmed âœ…"),l("/orderhistory")},E=async()=>{if(!i)return;const e=c(a,"users",t.currentUser.uid,"orders",i);await u(e,{status:"cancelled",tracking_status:"Cancelled"}),x(!1),d.info("Order Cancelled âŒ")};return v?s.jsx("div",{className:"text-center p-6",children:"Loading your cart..."}):n.length===0?s.jsxs("div",{className:"text-center p-6 text-gray-500 flex flex-col items-center gap-4",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Your cart is empty ðŸ›ï¸"}),s.jsx("p",{children:"Happy shopping! Explore our latest collection ðŸ‘”"}),b&&s.jsx("button",{onClick:()=>l("/orderhistory"),className:"bg-gray-200 text-gray-900 px-4 py-1 rounded-full hover:bg-gray-300 transition text-sm font-medium",children:"View Orders"})]}):s.jsxs("div",{className:"max-w-6xl mx-auto p-6 flex flex-col gap-6",children:[s.jsx(F,{}),s.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Your Cart"}),b&&s.jsx("button",{onClick:()=>l("/orderhistory"),className:"bg-gray-200 text-gray-900 px-3 py-1 rounded-full hover:bg-gray-300 transition text-xs font-medium mb-4 w-max",children:"View Orders"}),n.map(e=>s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 p-4 border rounded-2xl shadow-md hover:shadow-xl transition bg-white",children:[s.jsx("img",{src:e.image,alt:e.name,className:"w-28 h-28 object-cover rounded-xl"}),s.jsxs("div",{className:"flex-1 flex flex-col gap-1 text-center sm:text-left",children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.name}),e.selectedColor&&s.jsxs("span",{children:["Color: ",e.selectedColor]}),e.selectedSize&&s.jsxs("span",{children:["Size: ",e.selectedSize]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>U(e),className:"px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200 transition",children:"-"}),s.jsx("span",{className:"px-3 py-1 border rounded-full",children:e.quantity}),s.jsx("button",{onClick:()=>S(e),className:"px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200 transition",children:"+"})]}),s.jsxs("div",{className:"flex flex-col items-center sm:items-end gap-1",children:[s.jsxs("span",{className:"font-bold text-lg",children:["â‚¹",(e.price*e.quantity).toFixed(2)]}),s.jsx("button",{onClick:()=>R(e),className:"text-red-500 hover:text-red-700 text-sm",children:"Remove"})]})]},e.id)),s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("h2",{className:"text-2xl font-bold",children:["Total: â‚¹",y.toFixed(2)]}),s.jsx("button",{onClick:I,className:"bg-amber-400 text-gray-900 px-6 py-2 rounded-full hover:bg-amber-500 transition font-semibold text-lg",children:"Place Order"})]}),C&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/90 z-50",children:s.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-md text-center",children:[s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ðŸ‘” Order Placed!"}),s.jsx("p",{className:"mb-2",children:"Once order is shipped, you cannot cancel."}),s.jsxs("div",{className:"flex justify-center gap-4",children:[s.jsx("button",{onClick:P,className:"px-6 py-2 rounded-full bg-green-500 text-white hover:bg-green-600 transition font-medium",children:"Confirm"}),s.jsx("button",{onClick:E,className:"px-6 py-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition font-medium",children:"Cancel"})]})]})})]})};export{K as default};
